import pandas as pd
import numpy as np

# 读取CSV文件
file_path = '电压.csv'
data = pd.read_csv(file_path)

# 确保数据按时间戳排序
data = data.sort_values(by='timestamp')

# 获取唯一的电池名称
batteries = [f'单体电池电压2V-{i:03d}电池' for i in range(1, 25)]

# 创建一个字典来存储每节电池的最大dV/dt值
max_dv_dt_dict = {}

# 处理每节电池的数据
for battery in batteries:
    # 提取该电池的数据
    battery_data = data[data['clique_name'] == battery]

    # 确保有足够的数据点进行计算
    if len(battery_data) > 1:
        # 计算dV/dt
        time_diff = np.diff(battery_data['timestamp'])
        voltage_diff = np.diff(battery_data['val'])
        dv_dt = voltage_diff / time_diff

        # 找到最大dV/dt值
        max_dv_dt = np.max(dv_dt)
    else:
        max_dv_dt = np.nan  # 如果数据点不足，返回NaN

    # 将结果存储在字典中
    max_dv_dt_dict[battery] = max_dv_dt

# 打印每节电池的最大dV/dt值
for battery, max_dv_dt in max_dv_dt_dict.items():
    print(f"{battery}: 最大充电电压变化率 {max_dv_dt:.6f} V/s")

# 结果保存为DataFrame并展示
for battery, max_dv_dt in max_dv_dt_dict.items():
    print(f"{battery}: 最大充电电压变化率 {max_dv_dt:.6f} V/s")

# 单体电池电压2V-001电池: 最大充电电压变化率 0.008600 V/s
# 单体电池电压2V-002电池: 最大充电电压变化率 0.007600 V/s
# 单体电池电压2V-003电池: 最大充电电压变化率 0.006700 V/s
# 单体电池电压2V-004电池: 最大充电电压变化率 0.007100 V/s
# 单体电池电压2V-005电池: 最大充电电压变化率 0.007400 V/s
# 单体电池电压2V-006电池: 最大充电电压变化率 0.007700 V/s
# 单体电池电压2V-007电池: 最大充电电压变化率 0.007900 V/s
# 单体电池电压2V-008电池: 最大充电电压变化率 0.007200 V/s
# 单体电池电压2V-009电池: 最大充电电压变化率 0.007700 V/s
# 单体电池电压2V-010电池: 最大充电电压变化率 0.007600 V/s
# 单体电池电压2V-011电池: 最大充电电压变化率 0.007800 V/s
# 单体电池电压2V-012电池: 最大充电电压变化率 0.009100 V/s
# 单体电池电压2V-013电池: 最大充电电压变化率 0.007600 V/s
# 单体电池电压2V-014电池: 最大充电电压变化率 0.007900 V/s
# 单体电池电压2V-015电池: 最大充电电压变化率 0.008500 V/s
# 单体电池电压2V-016电池: 最大充电电压变化率 0.008500 V/s
# 单体电池电压2V-017电池: 最大充电电压变化率 0.008000 V/s
# 单体电池电压2V-018电池: 最大充电电压变化率 0.008700 V/s
# 单体电池电压2V-019电池: 最大充电电压变化率 0.008600 V/s
# 单体电池电压2V-020电池: 最大充电电压变化率 0.008900 V/s
# 单体电池电压2V-021电池: 最大充电电压变化率 0.009000 V/s
# 单体电池电压2V-022电池: 最大充电电压变化率 0.009000 V/s
# 单体电池电压2V-023电池: 最大充电电压变化率 0.008000 V/s
# 单体电池电压2V-024电池: 最大充电电压变化率 0.009400 V/s
# 单体电池电压2V-001电池: 最大充电电压变化率 0.008600 V/s
# 单体电池电压2V-002电池: 最大充电电压变化率 0.007600 V/s
# 单体电池电压2V-003电池: 最大充电电压变化率 0.006700 V/s
# 单体电池电压2V-004电池: 最大充电电压变化率 0.007100 V/s
# 单体电池电压2V-005电池: 最大充电电压变化率 0.007400 V/s
# 单体电池电压2V-006电池: 最大充电电压变化率 0.007700 V/s
# 单体电池电压2V-007电池: 最大充电电压变化率 0.007900 V/s
# 单体电池电压2V-008电池: 最大充电电压变化率 0.007200 V/s
# 单体电池电压2V-009电池: 最大充电电压变化率 0.007700 V/s
# 单体电池电压2V-010电池: 最大充电电压变化率 0.007600 V/s
# 单体电池电压2V-011电池: 最大充电电压变化率 0.007800 V/s
# 单体电池电压2V-012电池: 最大充电电压变化率 0.009100 V/s
# 单体电池电压2V-013电池: 最大充电电压变化率 0.007600 V/s
# 单体电池电压2V-014电池: 最大充电电压变化率 0.007900 V/s
# 单体电池电压2V-015电池: 最大充电电压变化率 0.008500 V/s
# 单体电池电压2V-016电池: 最大充电电压变化率 0.008500 V/s
# 单体电池电压2V-017电池: 最大充电电压变化率 0.008000 V/s
# 单体电池电压2V-018电池: 最大充电电压变化率 0.008700 V/s
# 单体电池电压2V-019电池: 最大充电电压变化率 0.008600 V/s
# 单体电池电压2V-020电池: 最大充电电压变化率 0.008900 V/s
# 单体电池电压2V-021电池: 最大充电电压变化率 0.009000 V/s
# 单体电池电压2V-022电池: 最大充电电压变化率 0.009000 V/s
# 单体电池电压2V-023电池: 最大充电电压变化率 0.008000 V/s
# 单体电池电压2V-024电池: 最大充电电压变化率 0.009400 V/s

